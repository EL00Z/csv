<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CSV Data Cleaner - Smart Filtering Tool</title>
    <style>
        /* --- simple modern styling --- */
        :root {
            --bg: #f5f7fb;
            --card: #fff;
            --accent: #5563d6;
            --accent-2: #6c63ff;
            --muted: #7a7f8c;
            --danger: #ff6b6b;
            --success: #2eb86a;
        }

        * { box-sizing: border-box; }
        html,body { height:100%; }
        body {
            margin:0;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: linear-gradient(180deg,#eef2ff 0%, #f4f7ff 100%);
            color:#1f2937;
            padding:28px;
        }

        .container {
            max-width:1200px;
            margin:0 auto;
            background: var(--card);
            border-radius:12px;
            box-shadow: 0 10px 30px rgba(20,20,40,0.08);
            overflow:hidden;
        }

        header {
            padding:22px 28px;
            border-bottom:1px solid #eef2ff;
            background: linear-gradient(90deg,var(--accent), var(--accent-2));
            color:white;
        }
        header h1 { margin:0; font-size:20px; font-weight:600; letter-spacing:0.2px; }
        header p { margin:4px 0 0; font-size:13px; opacity:0.95; }

        .main {
            padding:22px;
            display:grid;
            gap:18px;
        }

        .row { display:flex; gap:18px; align-items:flex-start; flex-wrap:wrap; }

        .file-card {
            flex:1 1 420px;
            background:linear-gradient(180deg,#fff,#fbfdff);
            border-radius:10px;
            padding:18px;
            border:1px solid #f0f4ff;
            display:flex;
            gap:14px;
            align-items:center;
        }

        .file-input-wrapper { display:flex; gap:12px; align-items:center; width:100%; }
        .file-btn {
            background:transparent;
            border:2px dashed rgba(86,84,214,0.18);
            padding:10px 16px;
            border-radius:8px;
            cursor:pointer;
            color:var(--accent-2);
            font-weight:600;
        }
        .file-info { font-size:13px; color:var(--muted); }
        input[type=file] { display:none; }

        .column-selector {
            flex: 0 0 260px;
            background: #fff;
            border: 1px solid #f0f4ff;
            border-radius: 10px;
            padding: 12px;
        }
        select { width:100%; padding:10px; border-radius:8px; border:1px solid #e6ecff; }

        .cards {
            display:grid;
            grid-template-columns: 1fr 1fr;
            gap:18px;
        }

        .card {
            background:#fff;
            border-radius:10px;
            padding:14px;
            border:1px solid #f0f4ff;
        }
        .card h3 { margin:0 0 10px 0; font-size:14px; display:flex; justify-content:space-between; align-items:center; color:var(--accent-2); }
        .toggle-switch {
            display:inline-flex;
            align-items:center;
            gap:8px;
            font-size:13px;
            color:var(--muted);
        }
        .keywords-container {
            background:#fbfdff;
            border-radius:8px;
            padding:10px;
            min-height:70px;
            display:flex;
            flex-wrap:wrap;
            gap:8px;
            margin-bottom:10px;
            border:1px dashed #eef4ff;
        }
        .keyword-tag {
            background:linear-gradient(90deg,var(--accent-2), var(--accent));
            color:white;
            padding:6px 10px;
            border-radius:999px;
            font-size:12px;
            display:inline-flex;
            align-items:center;
            gap:8px;
            cursor:pointer;
            user-select:none;
        }
        .keyword-tag .remove {
            background:rgba(255,255,255,0.18);
            border-radius:50%;
            padding:2px 6px;
            font-weight:700;
            font-size:12px;
            line-height:1;
        }
        .exclusion-tag { background:linear-gradient(90deg,#ff7a7a,#ff5a8a); }

        textarea.custom-keywords-input {
            width:100%;
            min-height:56px;
            padding:10px;
            border-radius:8px;
            border:1px solid #e8eefc;
            resize:vertical;
            font-size:13px;
        }
        .keyword-actions { display:flex; gap:8px; margin-top:8px; }
        .btn { padding:10px 12px; border-radius:8px; cursor:pointer; border:none; font-weight:600; font-size:13px; }
        .btn-primary { background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; }
        .btn-ghost { background:transparent; border:1px solid #eef4ff; color:var(--muted); }

        .actions {
            display:flex; gap:12px; justify-content:center; margin-top:6px;
        }
        .process { padding:12px 20px; border-radius:999px; background:var(--accent-2); color:white; border:none; cursor:pointer; font-weight:700; }
        .download { padding:12px 18px; border-radius:999px; background:var(--success); color:white; border:none; cursor:pointer; font-weight:700; display:none; }

        .stats-preview {
            display:grid;
            grid-template-columns: 1fr 1fr;
            gap:18px;
            align-items:start;
        }

        .stats {
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            background:#fff;
            border:1px solid #f0f4ff;
            padding:12px;
            border-radius:8px;
        }
        .stat { padding:10px; min-width:110px; background:linear-gradient(180deg,#ffffff,#fbfdff); border-radius:8px; text-align:center; border:1px solid #f6f8ff; }
        .stat .num { font-weight:700; font-size:18px; color:var(--accent-2); }
        .preview {
            background:#fff;
            border-radius:10px;
            padding:8px;
            border:1px solid #f0f4ff;
        }
        table { width:100%; border-collapse:collapse; font-size:13px; }
        th, td { padding:8px 10px; border-bottom:1px solid #f1f5ff; text-align:left; }
        th { background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; font-weight:700; position:sticky; top:0; }
        .note { font-size:12px; color:var(--muted); margin-top:6px; }

        @media (max-width:960px) {
            .cards { grid-template-columns: 1fr; }
            .stats-preview { grid-template-columns: 1fr; }
            .file-card { flex-direction:column; align-items:flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CSV Data Cleaner</h1>
            <p>Smart filtering tool ‚Äî improved parser, editable keywords, modern UI</p>
        </header>

        <div class="main">
            <div class="row">
                <div class="file-card">
                    <label class="file-input-wrapper">
                        <input id="csvFile" type="file" accept=".csv" />
                        <div class="file-btn">üìÇ Choose CSV (Max 50MB)</div>
                    </label>
                    <div class="file-info">
                        <div><strong>File:</strong> <span id="fileName">-</span></div>
                        <div class="note"><strong>Rows:</strong> <span id="rowCount">0</span> &nbsp; <strong>Columns:</strong> <span id="columnCount">0</span></div>
                    </div>
                </div>

                <div class="column-selector">
                    <label><strong>Select column to filter</strong></label>
                    <select id="columnSelect"><option value="">Select a column...</option></select>
                </div>
            </div>

            <div class="cards">
                <div class="card">
                    <h3>
                        ‚úÖ Inclusion Keywords
                        <span class="toggle-switch">
                            <label style="font-size:12px;color:var(--muted);">Enable</label>
                            <input id="inclusionToggle" type="checkbox" checked />
                        </span>
                    </h3>

                    <div id="inclusionKeywords" class="keywords-container" title="Click a keyword to remove it"></div>

                    <textarea id="customInclusion" class="custom-keywords-input" placeholder="Add custom inclusion keywords separated by commas (e.g. product, growth)"></textarea>
                    <div class="keyword-actions">
                        <button id="addInclusionBtn" class="btn btn-primary">Add</button>
                        <button id="clearInclusionBtn" class="btn btn-ghost">Clear</button>
                    </div>
                </div>

                <div class="card">
                    <h3>
                        ‚ùå Exclusion Keywords
                        <span class="toggle-switch">
                            <label style="font-size:12px;color:var(--muted);">Enable</label>
                            <input id="exclusionToggle" type="checkbox" checked />
                        </span>
                    </h3>

                    <div id="exclusionKeywords" class="keywords-container" title="Click a keyword to remove it"></div>

                    <textarea id="customExclusion" class="custom-keywords-input" placeholder="Add custom exclusion keywords separated by commas (e.g. intern, junior)"></textarea>
                    <div class="keyword-actions">
                        <button id="addExclusionBtn" class="btn btn-primary">Add</button>
                        <button id="clearExclusionBtn" class="btn btn-ghost">Clear</button>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button id="processBtn" class="process" disabled>üöÄ Process & Filter</button>
                <button id="downloadBtn" class="download">‚¨áÔ∏è Download Cleaned CSV</button>
            </div>

            <div class="stats-preview">
                <div class="stats" id="statsSection" style="display:none;">
                    <div class="stat"><div class="num" id="originalRows">0</div><div class="lbl">Original Rows</div></div>
                    <div class="stat"><div class="num" id="filteredRows">0</div><div class="lbl">Filtered Rows</div></div>
                    <div class="stat"><div class="num" id="removedRows">0</div><div class="lbl">Removed Rows</div></div>
                    <div class="stat"><div class="num" id="percentageKept">0%</div><div class="lbl">Data Retained</div></div>
                </div>

                <div class="preview" id="previewSection" style="display:none;">
                    <strong>Preview (first 10 rows)</strong>
                    <div style="margin-top:8px; overflow:auto; max-height:420px;">
                        <table id="previewTable"></table>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- initial defaults (kept similar to your original list, normalized to lowercase) ---
        const defaultInclusion = [
            'architect','asset management','blockchain','capital markets','cbdc','ceo','chief','chief digital officer',
            'chief innovation officer','chief strategy officer','cio','ciso','co-founder','coo','cpo','crypto','cto',
            'custody','data intelligence','defi','developer','digital asset','digital banking','digital currency',
            'digital transformation lead','director','director of digital assets','director of engineering','engineer',
            'executive','fintech','founder','general manager','global head of digital assets','growth lead','head',
            'head of blockchain and digital assets','head of defi','head of digital','head of digital assets','head of ecosystem',
            'head of engineering','head of enterprise architecture','head of global payments','head of growth','head of innovation',
            'head of it','head of payments','head of product','head of product innovation','head of retail payments','head of rwa',
            'head of stablecoins','head of strategy','head of strategy and innovation','head of tokenization','innovation','lead',
            'llm','manager','managing','managing director','managing partner','mena','open banking','partner','payment','payments',
            'platform','president','principal','product','product head','product strategy','rwa','senior','specialist','stablecoin',
            'strategy','tokenization','transformation','vp','vp of engineering','vp of it','vp of product'
        ];

        const defaultExclusion = [
            'account executive','accountant','academic','actor','administrative assistant','agriculture','airdrop','ambassador',
            'angel','angel investor','analyst','artist','assistant','attorney','audit','auditor','back-end developer','bdr',
            'business analyst','business development','business development representative','channel','chief of staff','community',
            'community manager','construction','content','content creator','controller','cpa','customer','customer service representative',
            'cyber security','data entry','data scientist','degen','devops engineer','doctor','editor','educator','energy','entertainment',
            'entry-level','epamsystems','event manager','executive assistant','factory','farmer','film','finance manager','financial models',
            'former','freight','front-end developer','gamer','gas','general counsel','giveaway','graphic designer','hardware','hardware engineer',
            'hospitality','hr','hr manager','human resources','industrial','influencer','intern','inventory','investor relations','junior',
            'journalist','kol','lawyer','lecturer','legal','legal counsel','logistics','manufacturing','marketer','marketing','marketing manager',
            'marketing specialist','materials','mechanical engineer','media','memes','memecoin','mining','moderator','music','musician',
            'non-profit','nurse','office manager','oil','operations manager','paralegal','petroleum','physical','physician','plant manager',
            'podcast','pr','prediction','private banker','producer','professor','program','project management','promoter','procurement',
            'public relations','qa','quality assurance','real estate','recruiter','recruitment consultant','researcher','risk','sales',
            'sales consultant','sales representative','scientist','shill','shiller','shipping','singer','smm','social media','social media manager',
            'software engineer','software test engineer','streamer','supply chain','support agent','sustainability','tax','teacher','team head',
            'technical lead','technician','telecom','talent acquisition','trenches','transportation','user','ux researcher','venture partner','warehouse',
            'web developer','writer','yapper','copywriter'
        ];

        // turn them into mutable arrays (all lowercase)
        let inclusionKeywords = Array.from(new Set(defaultInclusion.map(k => k.toLowerCase())));
        let exclusionKeywords = Array.from(new Set(defaultExclusion.map(k => k.toLowerCase())));

        // add requested additional keywords if not present
        const addExclusion = ['ux design','ui/ux','design ux','design ui','art director','treasury','creative director'];
        const addInclusion = ['ecosystem growth','defi','ecosystem','virtual assets'];

        addExclusion.forEach(k => { if (!exclusionKeywords.includes(k.toLowerCase())) exclusionKeywords.push(k.toLowerCase()); });
        addInclusion.forEach(k => { if (!inclusionKeywords.includes(k.toLowerCase())) inclusionKeywords.push(k.toLowerCase()); });

        // data containers
        let csvData = [];
        let headers = [];
        let processedData = [];

        // --- ELEMENTS ---
        const fileInput = document.getElementById('csvFile');
        const fileNameEl = document.getElementById('fileName');
        const rowCountEl = document.getElementById('rowCount');
        const columnCountEl = document.getElementById('columnCount');
        const columnSelect = document.getElementById('columnSelect');
        const processBtn = document.getElementById('processBtn');
        const downloadBtn = document.getElementById('downloadBtn');

        const inclusionContainer = document.getElementById('inclusionKeywords');
        const exclusionContainer = document.getElementById('exclusionKeywords');
        const customInclusion = document.getElementById('customInclusion');
        const customExclusion = document.getElementById('customExclusion');
        const addInclusionBtn = document.getElementById('addInclusionBtn');
        const addExclusionBtn = document.getElementById('addExclusionBtn');
        const clearInclusionBtn = document.getElementById('clearInclusionBtn');
        const clearExclusionBtn = document.getElementById('clearExclusionBtn');

        const inclusionToggle = document.getElementById('inclusionToggle');
        const exclusionToggle = document.getElementById('exclusionToggle');

        const statsSection = document.getElementById('statsSection');
        const originalRowsEl = document.getElementById('originalRows');
        const filteredRowsEl = document.getElementById('filteredRows');
        const removedRowsEl = document.getElementById('removedRows');
        const percentageKeptEl = document.getElementById('percentageKept');

        const previewSection = document.getElementById('previewSection');
        const previewTable = document.getElementById('previewTable');

        // --- UI / Keywords rendering ---
        function renderKeywords() {
            inclusionContainer.innerHTML = inclusionKeywords.map(k => {
                const label = escapeHtml(k);
                return `<span class="keyword-tag" data-key="${encodeURIComponent(k)}">${label} <span class="remove" title="Click to remove">√ó</span></span>`;
            }).join('');

            exclusionContainer.innerHTML = exclusionKeywords.map(k => {
                const label = escapeHtml(k);
                return `<span class="keyword-tag exclusion-tag" data-key="${encodeURIComponent(k)}">${label} <span class="remove" title="Click to remove">√ó</span></span>`;
            }).join('');
        }

        // small helper to avoid raw-html issues
        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#39;");
        }

        // removal via click (event delegation)
        inclusionContainer.addEventListener('click', (e) => {
            const tag = e.target.closest('.keyword-tag');
            if (!tag) return;
            const key = decodeURIComponent(tag.dataset.key);
            if (!key) return;
            if (confirm(`Remove inclusion keyword "${key}"?`)) {
                inclusionKeywords = inclusionKeywords.filter(k => k !== key);
                renderKeywords();
            }
        });

        exclusionContainer.addEventListener('click', (e) => {
            const tag = e.target.closest('.keyword-tag');
            if (!tag) return;
            const key = decodeURIComponent(tag.dataset.key);
            if (!key) return;
            if (confirm(`Remove exclusion keyword "${key}"?`)) {
                exclusionKeywords = exclusionKeywords.filter(k => k !== key);
                renderKeywords();
            }
        });

        // Add buttons
        addInclusionBtn.addEventListener('click', () => {
            const arr = parseKeywordInput(customInclusion.value);
            let added = 0;
            arr.forEach(k => {
                if (!inclusionKeywords.includes(k)) {
                    inclusionKeywords.push(k);
                    added++;
                }
            });
            if (added) {
                renderKeywords();
                customInclusion.value = '';
            } else {
                alert('No new inclusion keywords to add.');
            }
        });

        addExclusionBtn.addEventListener('click', () => {
            const arr = parseKeywordInput(customExclusion.value);
            let added = 0;
            arr.forEach(k => {
                if (!exclusionKeywords.includes(k)) {
                    exclusionKeywords.push(k);
                    added++;
                }
            });
            if (added) {
                renderKeywords();
                customExclusion.value = '';
            } else {
                alert('No new exclusion keywords to add.');
            }
        });

        clearInclusionBtn.addEventListener('click', () => customInclusion.value = '');
        clearExclusionBtn.addEventListener('click', () => customExclusion.value = '');

        function parseKeywordInput(text) {
            if (!text) return [];
            return text.split(',')
                .map(s => s.trim().toLowerCase())
                .filter(s => s);
        }

        // toggles visual feedback (optional)
        inclusionToggle.addEventListener('change', () => {
            inclusionContainer.style.opacity = inclusionToggle.checked ? '1' : '0.5';
        });
        exclusionToggle.addEventListener('change', () => {
            exclusionContainer.style.opacity = exclusionToggle.checked ? '1' : '0.5';
        });

        // --- CSV parser (robust) ---
        function parseCSV(text) {
            // remove BOM if present
            if (text && text.charCodeAt(0) === 0xFEFF) {
                text = text.slice(1);
            }

            const rows = [];
            let row = [];
            let cur = '';
            let inQuotes = false;
            for (let i = 0; i < text.length; i++) {
                const ch = text[i];

                if (ch === '"') {
                    // if next char is also a quote -> escaped quote
                    if (inQuotes && text[i+1] === '"') {
                        cur += '"';
                        i++; // skip next quote
                        continue;
                    }
                    inQuotes = !inQuotes;
                    continue;
                }

                if (ch === ',' && !inQuotes) {
                    row.push(cur);
                    cur = '';
                    continue;
                }

                if ((ch === '\n' || ch === '\r') && !inQuotes) {
                    // handle CRLF
                    if (ch === '\r' && text[i+1] === '\n') {
                        // skip the \n as well
                        row.push(cur);
                        rows.push(row);
                        row = [];
                        cur = '';
                        i++; // skip \n
                        continue;
                    } else {
                        row.push(cur);
                        rows.push(row);
                        row = [];
                        cur = '';
                        continue;
                    }
                }

                cur += ch;
            }

            // push last cell
            if (cur !== '' || row.length > 0) {
                row.push(cur);
                rows.push(row);
            }

            // remove any empty trailing rows (all fields empty)
            const cleanedRows = rows.filter(r => r.some(cell => String(cell).trim() !== ''));

            if (cleanedRows.length === 0) {
                return { headers: [], data: [] };
            }

            const headerRow = cleanedRows[0].map(h => String(h || '').trim());
            const data = [];

            for (let r = 1; r < cleanedRows.length; r++) {
                const arr = cleanedRows[r];
                const obj = {};
                for (let c = 0; c < headerRow.length; c++) {
                    obj[headerRow[c]] = (arr[c] !== undefined ? String(arr[c]).trim() : '');
                }
                data.push(obj);
            }

            return { headers: headerRow, data };
        }

        // CSV back to string (escape properly)
        function dataToCSV(headers, data) {
            const csvRows = [];
            csvRows.push(headers.map(h => {
                if (h.includes(',') || h.includes('"') || h.includes('\n')) {
                    return `"${h.replace(/"/g,'""')}"`;
                }
                return h;
            }).join(','));

            for (const row of data) {
                const values = headers.map(h => {
                    let val = row[h] !== undefined ? row[h] : '';
                    if (val === null) val = '';
                    val = String(val);
                    if (val.includes('"')) val = val.replace(/"/g, '""');
                    if (val.includes(',') || val.includes('"') || val.includes('\n')) {
                        return `"${val}"`;
                    }
                    return val;
                });
                csvRows.push(values.join(','));
            }
            return csvRows.join('\n');
        }

        // --- File handling ---
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 50 * 1024 * 1024) {
                alert('File exceeds 50MB.');
                fileInput.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const parsed = parseCSV(ev.target.result || '');
                    csvData = parsed.data || [];
                    headers = parsed.headers || [];

                    fileNameEl.textContent = file.name;
                    rowCountEl.textContent = csvData.length;
                    columnCountEl.textContent = headers.length;

                    // populate column select
                    populateColumns();

                    processBtn.disabled = headers.length === 0 || csvData.length === 0 ? true : false;
                    // hide results until processing
                    statsSection.style.display = 'none';
                    previewSection.style.display = 'none';
                    downloadBtn.style.display = 'none';
                } catch (err) {
                    alert('Error parsing CSV: ' + err.message);
                }
            };
            reader.readAsText(file, 'UTF-8');
        });

        function populateColumns() {
            columnSelect.innerHTML = '<option value="">Select a column...</option>';
            headers.forEach(h => {
                const opt = document.createElement('option');
                opt.value = h;
                opt.textContent = h;
                // default select heuristics
                if ((h.toLowerCase().includes('job') || h.toLowerCase().includes('title')) && columnSelect.selectedIndex === 0) {
                    opt.selected = true;
                }
                columnSelect.appendChild(opt);
            });
        }

        // --- Matching + Filtering ---
        function matchesKeywords(text, keywords) {
            if (!text) return false;
            const lower = String(text).toLowerCase();
            return keywords.some(k => lower.includes(k));
        }

        function filterData() {
            const selectedColumn = columnSelect.value;
            if (!selectedColumn) {
                alert('Select a column to filter.');
                return;
            }

            const inclusionEnabled = inclusionToggle.checked;
            const exclusionEnabled = exclusionToggle.checked;

            const inclusionList = inclusionEnabled ? inclusionKeywords : [];
            const exclusionList = exclusionEnabled ? exclusionKeywords : [];

            // If inclusion is enabled and list empty -> treat as "no inclusion filter"
            const effectiveInclusion = (inclusionEnabled && inclusionList.length > 0) ? inclusionList : null;

            processedData = csvData.filter(row => {
                const cell = row[selectedColumn] !== undefined ? row[selectedColumn] : '';

                // exclusion
                if (exclusionEnabled && exclusionList.length > 0 && matchesKeywords(cell, exclusionList)) {
                    return false;
                }

                // inclusion
                if (effectiveInclusion) {
                    return matchesKeywords(cell, effectiveInclusion);
                }

                // otherwise include
                return true;
            });

            updateStats();
            showPreview();
            downloadBtn.style.display = (processedData.length > 0) ? 'inline-block' : 'none';
        }

        function updateStats() {
            const original = csvData.length;
            const filtered = processedData.length;
            const removed = original - filtered;
            const pct = original > 0 ? Math.round((filtered / original) * 100) : 0;

            originalRowsEl.textContent = original;
            filteredRowsEl.textContent = filtered;
            removedRowsEl.textContent = removed;
            percentageKeptEl.textContent = pct + '%';

            statsSection.style.display = 'flex';
        }

        function showPreview() {
            previewTable.innerHTML = '';
            if (!headers.length || processedData.length === 0) {
                previewTable.innerHTML = '<tr><td style="padding:16px;">No data matches the filter criteria</td></tr>';
                previewSection.style.display = 'block';
                return;
            }

            // header row
            const thead = document.createElement('thead');
            const thr = document.createElement('tr');
            headers.forEach(h => {
                const th = document.createElement('th');
                th.textContent = h;
                thr.appendChild(th);
            });
            thead.appendChild(thr);
            previewTable.appendChild(thead);

            // body rows (max 10)
            const tbody = document.createElement('tbody');
            processedData.slice(0, 10).forEach(row => {
                const tr = document.createElement('tr');
                headers.forEach(h => {
                    const td = document.createElement('td');
                    td.textContent = row[h] || '';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            previewTable.appendChild(tbody);

            previewSection.style.display = 'block';
        }

        // --- Process & download handlers ---
        document.getElementById('processBtn').addEventListener('click', () => {
            filterData();
        });

        downloadBtn.addEventListener('click', () => {
            const csv = dataToCSV(headers, processedData);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cleaned_data.csv';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        });

        // initialize UI
        renderKeywords();

        // small helper: allow clicking the custom file-style button area
        document.querySelectorAll('.file-btn').forEach(btn => {
            btn.addEventListener('click', () => fileInput.click());
        });

    </script>
</body>
</html>
